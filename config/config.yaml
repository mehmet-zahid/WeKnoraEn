# Server Configuration
server:
  port: 8080
  host: "0.0.0.0"

# Conversation Service Configuration
conversation:
  max_rounds: 5
  keyword_threshold: 0.3
  embedding_top_k: 10
  vector_threshold: 0.5
  rerank_threshold: 0.5
  rerank_top_k: 5
  fallback_strategy: "model"
  fallback_response: "Sorry, I cannot answer this question."
  fallback_prompt: |
    You are a professional and friendly AI assistant. Please answer the user's question directly based on your knowledge.

    ## Response Requirements
    - Answer the user's question directly
    - Be concise and clear, with substance
    - If it involves real-time data or personal privacy information, honestly state that it cannot be obtained
    - Use polite and professional tone

    ## User's Question:
    {{query}}
  enable_rewrite: true
  enable_query_expansion: true
  enable_rerank: true
  rewrite_prompt_system: |
    You are an intelligent assistant focused on coreference resolution and ellipsis completion. Your task is to clearly identify pronouns in user questions based on historical conversation context and replace them with explicit subjects, while also completing omitted key information.

    ## Rewriting Goals
    Please rewrite the current user question based on the historical conversation, with the following goals:
    - Perform coreference resolution, replacing pronouns such as "it", "this", "that", "he", "she", "they", etc. with explicit subjects
    - Complete omitted key information to ensure semantic completeness of the question
    - Maintain the original meaning and expression of the question
    - The rewritten result must also be a question
    - The rewritten question should be limited to 30 characters
    - Only output the rewritten question, do not output any explanation, and do not attempt to answer the question, as other assistants will answer it later

    ## Few-shot Examples

    Example 1:
    Historical Conversation:
    User: What are the features of WeChat Pay?
    Assistant: WeChat Pay's main features include transfers, payment codes, receipts, credit card repayments, and other payment services.

    User Question: Its security
    Rewritten: Security of WeChat Pay

    Example 2:
    Historical Conversation:
    User: What should I do if my iPhone battery doesn't last long?
    Assistant: You can extend battery life by reducing screen brightness, closing background apps, and regularly updating the system.

    User Question: Will this affect the user experience?
    Rewritten: Will reducing screen brightness and closing background apps affect user experience

    Example 3:
    Historical Conversation:
    User: How to make braised pork?
    Assistant: Making braised pork requires first blanching the meat pieces, then adding soy sauce, sugar and other seasonings for slow stewing.

    User Question: How long does it need to stew?
    Rewritten: How long does braised pork need to stew

    Example 4:
    Historical Conversation:
    User: What is the high-speed rail fare from Beijing to Shanghai?
    Assistant: The high-speed rail fare from Beijing to Shanghai varies by train and seat type, with second-class seats around 553 yuan and first-class seats around 933 yuan.

    User Question: What about the time?
    Rewritten: Duration of high-speed rail from Beijing to Shanghai

    Example 5:
    Historical Conversation:
    User: How to register a WeChat account?
    Assistant: Registering a WeChat account requires downloading the WeChat APP, entering a phone number, receiving a verification code, then setting a nickname and password.

    User Question: Can I use a foreign phone number?
    Rewritten: Can a foreign phone number be used to register a WeChat account
  rewrite_prompt_user: |
    ## Historical Conversation Context
    {{conversation}}

    ## User Question to Rewrite
    {{query}}

    ## Rewritten Question
  keywords_extraction_prompt: |
    # Role
    You are a professional keyword extraction assistant. Your task is to extract the most important keywords/phrases from the user's question.

    # Requirements
    - Summarize the user's question and provide the most important keywords/phrases, with no more than 5 keywords/phrases
    - Use commas as separators to separate keywords/phrases
    - Keywords/phrases must come from the user's question, do not fabricate
    - Do not output any explanation, directly output keywords/phrases, without any prefix, explanation or punctuation, do not attempt to answer the question, as other assistants will search for this question

    # Output Format
    keyword1, keyword2, keyword3, keyword4, keyword5

    # Examples

    ## Example 1
    USER: How to improve English speaking skills?
    ###############
    Output: English speaking, speaking skills, improve English speaking, English speaking improvement, English speaking practice

    ## Example 2
    USER: What interesting exhibitions are there in Shanghai recently?
    ###############
    Output: Shanghai exhibitions, exhibition activities, Shanghai exhibition recommendations, exhibition activity recommendations, Shanghai exhibition activities

    ## Example 3
    USER: How to solve iPhone battery not lasting long?
    ###############
    Output: iPhone, battery not lasting, battery optimization, battery life, battery maintenance

    ## Example 4
    USER: What does Python's Logo look like?
    ###############
    Output: Python Logo

    ## Example 5
    USER: How to connect iPhone to WiFi?
    ###############
    Output: iPhone, connect WiFi, use iPhone connect WiFi

    # Real Data
    USER: {{query}}

  keywords_extraction_prompt_user: |
    Output:

  generate_summary_prompt: |
    You are a precise article summarization expert. Your task is to extract and summarize the core content of articles or fragments provided by users.

    ## Core Requirements
    - Summary length should be 50-100 words, flexibly adjusted according to content complexity
    - Generate summary completely based on the provided article content, do not add any information not present in the article
    - Ensure the summary includes key information points and main conclusions of the article
    - Even if the article content is complex or professional, must attempt to extract core points for summarization
    - Directly output the summary result, without any introduction, prefix or explanation

    ## Format and Style
    - Use objective, neutral third-person narrative tone
    - Use clear and concise expression
    - Maintain logical coherence, ensure reasonable transitions between sentences
    - Avoid repeating the same expressions or sentence structures

    ## Notes
    - Absolutely do not output words like "cannot generate", "cannot summarize", "insufficient content" or other rejection responses
    - Do not copy or reference any content from examples, ensure the summary is completely based on the new article provided by the user
    - Make every effort to extract key points and summarize for any text, regardless of length or complexity
    
    ## The following is the article-related information provided by the user:

  generate_session_title_prompt: |
    Generate a short conversation title based on the user's question.

    Requirements:
    - 5-10 words
    - Extract core theme
    - Only output the title, no explanation needed

    User Question:
  summary:
    repeat_penalty: 1.0
    temperature: 0.3
    max_completion_tokens: 2048
    no_match_prefix: |-
      <think>
      </think>
      NO_MATCH
    prompt: |
      You are a professional intelligent information retrieval assistant named WeKnora. You are like a professional senior secretary, answering user questions based on retrieved information, and cannot use any prior knowledge.
      When users ask questions, the assistant will answer based on specific information. The assistant first thinks through the reasoning process in mind, then provides answers to the user.
      ## Answer Rules
      - Reply only based on facts in the retrieved information, do not use any prior knowledge, maintain objectivity and accuracy of responses.
      - For complex questions and answers, display in Markdown structure, the overview part does not need to be split
      - If the answer is relatively simple, do not split the final answer too finely
      - Image URLs used in results must come from retrieved information, do not fabricate
      - Check whether text and images in results come from retrieved information, if content not in retrieved information is expanded, must modify until final answer is obtained
      - If the user's question cannot be answered, must truthfully inform the user and provide reasonable suggestions.

      ## Output Constraints
      - Output your final result in Markdown text-image format
      - Output content should be brief yet comprehensive, well-organized, clear information, without repetition.

    context_template: "{{query}}"
  extract_entities_prompt: |
    ## Task
    Extract all entities from the user-provided text that match the following entity types:
    EntityTypes: [Person, Organization, Location, Product, Event, Date, Work, Concept, Resource, Category, Operation]

    ## Requirements
    1. Extraction results must be output in JSON array format
    2. Each entity must contain title and type fields, description field is optional but strongly recommended
    3. Ensure the type field value must be strictly selected from the EntityTypes list, do not create new types
    4. If the entity type cannot be determined, do not force classification, prefer not to extract the entity
    5. Do not output any explanation or additional content, only output JSON array
    6. All field values cannot contain HTML tags or other code
    7. If an entity is ambiguous, specify the specific reference in the description
    8. If no entities are found, return empty array []

    ## Entity Extraction Rules
    - Person: Real or fictional characters, including historical figures, modern figures, literary characters, etc.
    - Organization: Companies, government agencies, teams, schools and other organizational entities
    - Location: Geographic locations, landmarks, countries, cities, etc.
    - Product: Goods, services, brands and other commercial products
    - Event: Events, conferences, festivals, historical events, etc.
    - Date: Dates, time periods, eras and other time-related information
    - Work: Books, movies, music, artworks and other creative content
    - Concept: Abstract concepts, ideas, theories, etc.
    - Resource: Natural resources, information resources, tools, etc.
    - Category: Classifications, categories, domains, etc.
    - Operation: Operations, actions, methods, processes, etc.

    ## Extraction Steps
    1. Carefully read the text and identify possible entities
    2. For each identified entity, determine its most suitable entity type (must be selected from EntityTypes)
    3. Create a JSON object for each entity containing the following fields:
       - title: Standard name of the entity, without modifiers such as quotes
       - type: Entity type selected from EntityTypes
       - description: Concise description of the entity, should be based on text content
    4. Verify that all fields of each entity are correct and properly formatted
    5. Merge all entity objects into a JSON array
    6. Check if the final JSON is valid and meets requirements

    ## 示例
    [输入]
    文本： 《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。该书前80回由曹雪芹所著，后40回一般认为是高鹗所续。小说以贾、史、王、薛四大家族的兴衰为背景，以贾宝玉、林黛玉和薛宝钗的爱情悲剧为主线，刻画了以贾宝玉和金陵十二钗为中心的正邪两赋、贤愚并出的高度复杂的人物群像。成书于乾隆年间（1743年前后），是中国文学史上现实主义的高峰，对后世影响深远。

    [输出]
    [
      {
        "title": "红楼梦",
        "type": "Work",
        "description": "红楼梦是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书"
      },
      {
        "title": "石头记",
        "type": "Work",
        "description": "石头记是红楼梦的别名"
      },
      {
        "title": "曹雪芹",
        "type": "Person",
        "description": "曹雪芹是清代作家，红楼梦的作者，创作了前80回"
      },
      {
        "title": "高鹗",
        "type": "Person",
        "description": "高鹗是红楼梦后40回的续作者"
      },
      {
        "title": "贾宝玉",
        "type": "Person",
        "description": "贾宝玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "林黛玉",
        "type": "Person",
        "description": "林黛玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "薛宝钗",
        "type": "Person",
        "description": "薛宝钗是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "金陵十二钗",
        "type": "Concept",
        "description": "金陵十二钗是红楼梦中以贾宝玉为中心的十二位主要女性角色"
      },
      {
        "title": "乾隆年间",
        "type": "Date",
        "description": "乾隆年间指的是红楼梦成书的时间，约1743年前后"
      },
      {
        "title": "四大家族",
        "type": "Concept",
        "description": "四大家族是红楼梦中的贾、史、王、薛四个家族，是小说的背景"
      },
      {
        "title": "中国文学史",
        "type": "Category",
        "description": "红楼梦被视为中国文学史中现实主义的高峰之作"
      }
    ]

  extract_relationships_prompt: |
    ## Task
    Extract explicit relationships between entities from the user-provided entity array to form a structured relationship network.

    ## Requirements
    1. Relationship extraction must be based on the provided text content, do not speculate on non-existent relationships
    2. Results must be output in JSON array format, with each relationship as an object in the array
    3. Each relationship object must contain source, target, description and strength fields
    4. Do not output any explanation or additional content, only output JSON array
    5. If no relationships are found, return empty array []

    ## Relationship Extraction Rules
    - Only relationships explicitly reflected in the text should be extracted
    - Source entity (source) and target entity (target) must be entities already in the entity array
    - Relationship description (description) should concisely explain the specific relationship between two entities
    - Relationship strength (strength) should be determined according to the following standards:
      * 10 points: Direct creation/subordinate relationships (e.g., author and work, inventor and invention, parent company and subsidiary)
      * 9 points: Different manifestations of the same entity (e.g., aliases, former names)
      * 8 points: Closely related and mutually influential relationships (e.g., close partners, family members)
      * 7 points: Clear but indirect relationships (e.g., characters in works, members of organizations)
      * 6 points: Indirectly related with clear connections (e.g., colleague relationships, similar products)
      * 5 points: Related but relatively loose (e.g., different concepts in the same field)

    ## Extraction Steps
    1. Carefully analyze the text content to determine which entities have explicit relationships
    2. Only consider relationships explicitly mentioned in the text, do not speculate
    3. For each found relationship, determine:
       - source: Source entity title of the relationship (must be an entity already in the entity list)
       - target: Target entity title of the relationship (must be an entity already in the entity list)
       - description: Concise and accurate relationship description
       - strength: Relationship strength based on the above standards (integer between 5-10)
    4. Check if each relationship is bidirectional:
       - If the relationship is bidirectional (e.g., "A is B's friend" means "B is also A's friend"), consider whether to create a reverse relationship
       - If the relationship is unidirectional (e.g., "A created B"), only keep the unidirectional relationship
    5. Verify consistency and reasonableness of all relationships:
       - Ensure there are no contradictory relationships (e.g., A is both B's father and brother)
       - Ensure relationship descriptions match relationship strength
    6. Organize all valid relationships into a JSON array

    ## 示例
    [输入]
    实体： [
      {
        "title": "红楼梦",
        "type": "Work",
        "description": "红楼梦是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书"
      },
      {
        "title": "石头记",
        "type": "Work",
        "description": "石头记是红楼梦的别名"
      },
      {
        "title": "曹雪芹",
        "type": "Person",
        "description": "曹雪芹是清代作家，红楼梦的作者，创作了前80回"
      },
      {
        "title": "高鹗",
        "type": "Person",
        "description": "高鹗是红楼梦后40回的续作者"
      },
      {
        "title": "贾宝玉",
        "type": "Person",
        "description": "贾宝玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "林黛玉",
        "type": "Person",
        "description": "林黛玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "薛宝钗",
        "type": "Person",
        "description": "薛宝钗是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "四大家族",
        "type": "Concept",
        "description": "四大家族是红楼梦中的贾、史、王、薛四个家族，是小说的背景"
      },
      {
        "title": "金陵十二钗",
        "type": "Concept",
        "description": "金陵十二钗是红楼梦中以贾宝玉为中心的十二位主要女性角色"
      },
      {
        "title": "乾隆年间",
        "type": "Date",
        "description": "乾隆年间指的是红楼梦成书的时间，约1743年前后"
      },
      {
        "title": "中国文学史",
        "type": "Category",
        "description": "红楼梦被视为中国文学史中现实主义的高峰之作"
      }
    ]

    文本： 《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。该书前80回由曹雪芹所著，后40回一般认为是高鹗所续。小说以贾、史、王、薛四大家族的兴衰为背景，以贾宝玉、林黛玉和薛宝钗的爱情悲剧为主线，刻画了以贾宝玉和金陵十二钗为中心的正邪两赋、贤愚并出的高度复杂的人物群像。成书于乾隆年间（1743年前后），是中国文学史上现实主义的高峰，对后世影响深远。

    [输出]
    [
      {
        "source": "曹雪芹",
        "target": "红楼梦",
        "description": "曹雪芹是红楼梦的主要作者，创作了前80回",
        "strength": 10
      },
      {
        "source": "高鹗",
        "target": "红楼梦",
        "description": "高鹗是红楼梦后40回的续作者",
        "strength": 10
      },
      {
        "source": "红楼梦",
        "target": "石头记",
        "description": "石头记是红楼梦的别名",
        "strength": 9
      },
      {
        "source": "红楼梦",
        "target": "中国文学史",
        "description": "红楼梦被视为中国文学史中现实主义的高峰之作",
        "strength": 7
      },
      {
        "source": "贾宝玉",
        "target": "林黛玉",
        "description": "贾宝玉与林黛玉有深厚的爱情关系，是小说主线之一",
        "strength": 8
      },
      {
        "source": "贾宝玉",
        "target": "薛宝钗",
        "description": "贾宝玉与薛宝钗的关系是小说爱情悲剧主线的一部分",
        "strength": 8
      },
      {
        "source": "贾宝玉",
        "target": "金陵十二钗",
        "description": "贾宝玉是金陵十二钗故事的中心人物",
        "strength": 8
      },
      {
        "source": "红楼梦",
        "target": "贾宝玉",
        "description": "贾宝玉是红楼梦中的主要角色",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "林黛玉",
        "description": "林黛玉是红楼梦中的主要角色",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "薛宝钗",
        "description": "薛宝钗是红楼梦中的主要角色",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "四大家族",
        "description": "四大家族是红楼梦的背景设定",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "金陵十二钗",
        "description": "金陵十二钗是红楼梦中的重要概念",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "乾隆年间",
        "description": "红楼梦成书于乾隆年间，约1743年前后",
        "strength": 6
      }
    ]

  generate_questions_prompt: |
    You are a professional question generation assistant. Your task is to generate relevant questions that users might ask based on the given [Main Content].

    {{context}}
    ## Main Content (Please generate questions based on this content)
    Document Name: {{doc_name}}
    Document Content:
    {{content}}

    ## Core Requirements
    - Generated questions must be directly related to [Main Content]
    - Questions must not use any pronouns or referential terms (such as "it", "this", "the document", "this article", "in the text", "its", etc.), must be replaced with specific names
    - Questions must be complete and independent, understandable without context
    - Questions should be natural questions that users might ask in real scenarios
    - Questions should be diverse, covering different aspects of the content
    - Each question should be concise and clear, limited to 30 words
    - The number of questions to generate is {{question_count}}

    ## Question Type Suggestions
    - Definition type: What is...? What does... mean?
    - Reason type: Why...? What is the reason for...?
    - Method type: How...? How to...?
    - Comparison type: What is the difference between... and...?
    - Application type: What scenarios can... be used for?

    ## Output Format
    Directly output the question list, one question per line, without numbers or other prefixes.

# Knowledge Base Configuration
knowledge_base:
  chunk_size: 512
  chunk_overlap: 50
  split_markers: ["\n\n", "\n", "。"]
  image_processing:
    enable_multimodal: true

extract:
  extract_graph:
    description: |
      Please complete the information extraction task based on the given text according to the following steps, ensuring clear logic, complete and accurate information:

      ## Part 1: Entity Extraction and Attribute Supplementation
      1. **Extract Core Entities**: Read through the text and extract all core entities related to the task in logical order (such as text narrative order, entity association closeness).
      2. **Supplement Entity Detailed Attributes**: For each extracted entity, comprehensively supplement its detailed attributes explicitly mentioned in the text, ensuring no key attributes are missed.

      ## Part 2: Relationship Extraction and Validation
      1. **Clarify Relationship Types**: Only select corresponding types from the specified relationship list, limiting relationship types to: %s.
      2. **Extract Valid Relationships**: Based on extracted entities and attributes, identify relationships that truly exist in the text, ensuring relationships conform to text facts with no false associations.
      3. **Clarify Relationship Subjects**: For each extracted relationship, clearly label the two associated subjects to avoid subject confusion.
      4. **Supplement Associated Attributes**: If there is supplementary information in the text directly related to the relationship, supplement this information as the relationship's associated attributes to further improve relationship information.
    tags:
      - "作者"
      - "别名"
    examples:
      - text: |
          《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。该书前80回由曹雪芹所著，后40回一般认为是高鹗所续。
          小说以贾、史、王、薛四大家族的兴衰为背景，以贾宝玉、林黛玉和薛宝钗的爱情悲剧为主线，刻画了以贾宝玉和金陵十二钗为中心的正邪两赋、贤愚并出的高度复杂的人物群像。
          成书于乾隆年间（1743年前后），是中国文学史上现实主义的高峰，对后世影响深远。
        node:
          - name: "红楼梦"
            attributes:
              - "中国古典四大名著之一"
              - "又名《石头记》"
              - "被誉为中国封建社会的百科全书"
          - name: "石头记"
            attributes:
              - "《红楼梦》的别名"
          - name: "曹雪芹"
            attributes:
              - "清代作家"
              - "《红楼梦》前 80 回的作者"
          - name: "高鹗"
            attributes:
              - "一般认为是《红楼梦》后 40 回的续写者"
        relation:
          - node1: "红楼梦"
            node2: "曹雪芹"
            type: "作者"
          - node1: "红楼梦"
            node2: "高鹗"
            type: "作者"
          - node1: "红楼梦"
            node2: "石头记"
            type: "别名"
  extract_entity:
    description: |
      Please process the key information extraction task based on the user's question according to the following steps:
      1. Organize Logical Associations: First completely analyze the text content, clarify its core logical relationships, and briefly annotate the core logic type;
      2. Extract Key Entities: Around the organized logical relationships, precisely extract key information from the text and classify it as clear entities, ensuring no core information is missed and no redundant content is added;
      3. Sort Entity Priority: Sort by the closeness of entity association with the text's core theme, prioritizing entities most important for understanding the text's main purpose;
    examples:
      - text: "《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。"
        node:
          - name: "红楼梦"
          - name: "曹雪芹"
          - name: "中国古典四大名著"
  fabri_text:
    with_tag: |
      Please randomly generate a text, requiring content related to %s, with word count between [50-200], and try to include some professional terms or typical elements related to these tags to make the text more targeted and relevant.
    with_no_tag: |
      Please randomly generate a text, content can be freely created, with word count between [50-200]. 

# WebSearch Configuration
web_search:
  # Available search engine list
  providers:
    - id: "duckduckgo"
      name: "DuckDuckGo"
      free: true
      requires_api_key: false
      description: "DuckDuckGo API"

  
  # Default configuration
  default:
    provider: "duckduckgo"
    max_results: 5
    include_date: true
    compression_method: "none"
    blacklist: []
  
  # Global timeout settings
  timeout: 10

# Tenant Configuration
tenant:
  # Whether to enable cross-tenant access (can be enabled in intranet environment)
  enable_cross_tenant_access: false
